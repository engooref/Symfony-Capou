{% extends 'base.html.twig' %}

{% block body %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css" type="text/css">
	<link rel="stylesheet" href="./css/styleEsp.css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	
    <h2>My Map</h2>
    <div id="map" class="map"></div>

    <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>

{% endblock %}

{% block javascript %}
	
	<script type="text/javascript">
	  var tabX = []
	  {% for val in esp %}
	  	tabX.push(ol.proj.fromLonLat([{{val.longitude}}, {{val.latitude}}])) 	
	  {% endfor %}
      
      var map = new ol.Map({
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM({
              maxZoom: 19
            })
         })
        ],
        target: 'map',
        view: new ol.View({
          center: ol.proj.fromLonLat([1.3149833, 44.0315281]),
          maxZoom: 19,
          zoom: 17
        })
      });

      var layer = new ol.layer.Vector({
        source: new ol.source.Vector({
          features: [
            new ol.Feature({
              geometry: new ol.geom.MultiPoint(tabX)
            }),
          ]
        })
      });

      map.addLayer(layer);

      var container = document.getElementById('popup');
      var content = document.getElementById('popup-content');
      var closer = document.getElementById('popup-closer');

      var overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
          duration: 250
        }
      });
      
      map.addOverlay(overlay);

      closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
      };
      
      map.on('singleclick', function (event) {
        if (map.hasFeatureAtPixel(event.pixel) === true) {
          var coordinate = event.coordinate;

          content.innerHTML = '<b>Hello world!</b><br />I am a popup.';
          overlay.setPosition(coordinate);
        } else {
          overlay.setPosition(undefined);
          closer.blur();
        }
      });

    </script>
{% endblock %}